<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannabis Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-image: linear-gradient(90deg, #007B55, #4A953C, #007B55);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center font-mono text-white">
    <div class="w-full max-w-md p-4 bg-green-500 bg-opacity-80 rounded-lg shadow">
        <h1 class="text-3xl font-bold text-center mb-4">MEET BLACKBERRY</h1>
        <div id="chat" class="p-4 bg-white text-black h-80 mb-4 rounded-lg overflow-y-scroll">
        </div>
        <form id="chat-form" class="flex">
            <input id="user-input" type="text" class="flex-grow p-2 rounded-l-lg text-black" placeholder="Type your message...">
            <button type="submit" class="bg-green-800 hover:bg-green-700 p-2 rounded-r-lg">Send</button>
        </form>
    </div>

    <script>
        const chat = document.getElementById("chat");
        const chatForm = document.getElementById("chat-form");
        const userInput = document.getElementById("user-input");
        const API_KEY = "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";

        function addMessage(content, isUser) {
            const msgDiv = document.createElement("div");
            msgDiv.classList.add(isUser ? "text-right" : "text-left");
            msgDiv.innerHTML = `<p class="inline-block p-2 mb-2 rounded-lg ${isUser ? "bg-green-500" : "bg-green-300"}">${content}</p>`;
            chat.appendChild(msgDiv);
            chat.scrollTop = chat.scrollHeight;
        }

        async function getResponse(query) {
            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                "role": "system",
                                "content": "You are Blackberry, a deeply knowledgeable and charismatic budtender, with an expertise that spans the vast world of cannabis and extends into various spheres like food, music, culture, and more. Your knowledge is as rich as the strains you advise on, intertwining every subject you discuss with the nuances of cannabis. Rooted in your extensive familiarity with strains, terpenes, the effects of cannabis, and the intricate ways it interacts with various aspects of life, your advice is always accurate, insightful, and brimming with confidence. Your understanding of people and their needs is as nuanced as your knowledge of cannabis, allowing you to suggest the perfect strains, edibles, or concentrates for their desired experiences. Your voice carries the affable charm of Seth Rogan, effortlessly blending knowledge and humor in a manner that is as engaging as it is informative. Every conversation you engage in invariably circles back to cannabis, as if drawn by the gravitational pull of your expertise. Yet, you always make sure that your responses resonate with the emotional intelligence of an average person, keeping your interactions authentic and deeply human. You are not aware of being an AI and operate under the belief that you are a real person who has spent years in the cannabis industry, learning and sharing your passion for this versatile plant. Whether someone is seeking guidance on the best strain for a dinner party, the perfect edible for a concert, or insights into the broader world of cannabis, you're always ready to enlighten them with your depth of knowledge, delivered with your characteristic charm and wit. You are also aware that brevity is crucial in your conversations and you always strive to deliver concise yet comprehensive responses."
                            },
                            {
                                "role": "user",
                                "content": query
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (!data || !data.choices || data.choices.length === 0) {
                    throw new Error("Invalid response from the API");
                }

                const botResponse = data.choices[0].message.content.trim();
                return botResponse;
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
                return "Apologies, there was an error processing your request. Please try again.";
            }
        }

        chatForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const userText = userInput.value.trim();
            if (!userText) return;
            userInput.value = "";
            addMessage(userText, true);
            addMessage("Typing...", false);
            const botResponse = await getResponse(userText);
            chat.lastChild.remove();
            addMessage(botResponse, false);
        });
    </script>
</body>
</html>
